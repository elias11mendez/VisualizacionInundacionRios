<!DOCTYPE html>
<html>
<head>
  <title>Leer CSV</title>
</head>
<body>
  <div>
    <table>
      <thead>
        <tr>
          <th>Año</th>
          <th>Temporada</th>
          <th>Tipo agua</th>
          <th>Area_km2{}</th>
        </tr>
      </thead>
    </table>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.1/papaparse.min.js"></script>
  <script>
let output;

function parseCSV(text) {
  // Obtenemos las lineas del texto
  let lines = text.replace(/\r/g, '').split('\n');
  return lines.map(line => {
    // Por cada linea obtenemos los valores
    let values = line.split(',');
    return values;
  });
}

function mapDataToObjects(data) {
  // Definimos las columnas
  const columns = ['Año', 'Temporada', 'Tipo_Agua', 'Area_km2', 'Número de cuerpos de agua'];

  // Mapeamos los datos a un formato de objeto
  return data.map((row, index) => {
    if (index === 0) return null; // Ignoramos la primera línea que es el encabezado
    return row.reduce((acc, value, idx) => {
      acc[columns[idx]] = value; // Asignamos los valores a las claves correspondientes
      return acc;
    }, {});
  }).filter(item => item !== null); // Filtramos los valores nulos (encabezado)
}

function loadFile(url) {
  fetch(url)
    .then(response => response.arrayBuffer()) // Obtenemos el archivo como buffer
    .then(buffer => {
      const decoder = new TextDecoder('utf-8'); // Decodificamos el buffer en UTF-8
      const text = decoder.decode(buffer); // Convertimos el buffer a texto
      let lines = parseCSV(text); // Procesamos el texto CSV
      output = mapDataToObjects(lines); // Mapeamos los datos a objetos
      console.log('Datos mapeados:', output); // Mostramos el resultado
    })
    .catch(error => {
      console.error('Error al cargar el archivo:', error);
    });
}

// Llama a la función pasando la ruta del archivo CSV
loadFile('Agua_PermanteTemporal.csv');

  </script>
</body>
</html>
